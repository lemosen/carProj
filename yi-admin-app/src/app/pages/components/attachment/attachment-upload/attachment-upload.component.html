<ng-template [ngIf]="showHeader">
    <div class="panel-heading">
        <em class="fa fa-comment-o fa-fw"></em>({{attachments?.length}})
        <small>附件</small>
    </div>
</ng-template>

<div class="dd">
    <input #fileUpload style="display: none;" type="file" ng2FileSelect [uploader]="uploader" (change)="selectedFileOnChanged($event)" multiple/>
    <app-attachment-item [allowRemove]="allowRemove" [attachments]="attachments" (onRemoveAttachment)="removeAttachmentSubscription($event)"></app-attachment-item>
</div>

<ng-template [ngIf]="uploader.queue.length">
    <div class="panel-body pb0">
        <div class="row pt-sm pb-sm bb">
            <strong class="col-lg-4">待上传文件数量：{{ uploader.queue.length }}</strong>
        </div>
        <div class="row pt-sm bb">
            <div class="col-lg-4">名称</div>
            <div class="col-lg-4">进度</div>
            <div class="col-lg-1">大小</div>
            <div class="col-lg-1">状态</div>
            <div class="col-lg-2">操作</div>
        </div>

        <div class="row pt-sm pb-sm bb" *ngFor="let item of uploader.queue">
            <div class="col-lg-4"><strong>{{ item?.file?.name }}</strong></div>
            <div class="col-lg-4 mb0">
                <ngb-progressbar [showValue]="true" type="info" [value]="item.progress"><b>{{item.progress}}%</b></ngb-progressbar>
            </div>
            <div class="col-lg-1">{{ item?.file?.size/1024/1024 | number:'.2' }} MB</div>
            <div class="col-lg-1">
                <span *ngIf="item.isSuccess">成功</span>
                <span *ngIf="!item.isUploaded">未上传</span>
                <span *ngIf="item.isCancel">取消</span>
                <span *ngIf="item.isError">错误</span>
            </div>
            <div class="col-lg-2">
                <button type="button" class="btn btn-success btn-xs" (click)="item.upload()" [disabled]="item.isReady || item.isUploading || item.isSuccess">
                    <span class="fa fa-upload"></span> 上传
                </button>
                <button type="button" class="btn btn-warning btn-xs" (click)="item.cancel()" [disabled]="!item.isUploading">
                    <span class="fa fa-warning"></span> 取消
                </button>
                <button type="button" class="btn btn-danger btn-xs" (click)="item.remove()">
                    <span class="fa fa-trash-o"></span> 删除
                </button>
            </div>
        </div>

        <div class="row pt-sm pb-sm bb">
            <span class="col-lg-1">总体进度:</span>
            <div class="col-lg-11">
                <ngb-progressbar [showValue]="true" type="info" [value]="uploader.progress/uploader.queue.length"><b>{{uploader.progress/uploader.queue.length}}%</b>
                </ngb-progressbar>
            </div>
        </div>

        <div class="row pt-sm pb-sm text-center">
            <button type="button" class="btn btn-success" (click)="fileAllUp()" [disabled]="!uploader.getNotUploadedItems().length">
                <span class="fa fa-upload"></span> 上传所有
            </button>
            <button type="button" class="btn btn-warning" (click)="fileAllCancel()" [disabled]="!uploader.isUploading">
                <span class="fa fa-warning"></span> 取消所有
            </button>
            <button type="button" class="btn btn-danger" (click)="fileAllDelete()" [disabled]="!uploader.queue.length">
                <span class="fa fa-trash-o"></span> 删除所有
            </button>
        </div>
    </div>

</ng-template>
